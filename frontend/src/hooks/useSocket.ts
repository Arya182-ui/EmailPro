import { useEffect, useState } from 'react';\nimport io, { Socket } from 'socket.io-client';\nimport { useAuth } from './useAuth';\n\nexport interface Notification {\n  type: 'success' | 'error' | 'info' | 'warning';\n  title: string;\n  message: string;\n  timestamp: Date;\n  data?: any;\n}\n\nexport interface CampaignUpdate extends Notification {\n  campaignId: string;\n}\n\ninterface UseSocketReturn {\n  socket: Socket | null;\n  isConnected: boolean;\n  notifications: Notification[];\n  campaignUpdates: CampaignUpdate[];\n  subscribeToCampaign: (campaignId: string) => void;\n  unsubscribeFromCampaign: (campaignId: string) => void;\n  clearNotifications: () => void;\n  markAsRead: (index: number) => void;\n}\n\nexport const useSocket = (): UseSocketReturn => {\n  const [socket, setSocket] = useState<Socket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [campaignUpdates, setCampaignUpdates] = useState<CampaignUpdate[]>([]);\n  const { token } = useAuth();\n\n  useEffect(() => {\n    if (!token) {\n      // Cleanup socket if no token\n      if (socket) {\n        socket.disconnect();\n        setSocket(null);\n        setIsConnected(false);\n      }\n      return;\n    }\n\n    // Initialize socket connection\n    const newSocket = io('http://localhost:3000', {\n      auth: {\n        token: token\n      },\n      transports: ['websocket', 'polling']\n    });\n\n    newSocket.on('connect', () => {\n      console.log('Connected to notification service');\n      setIsConnected(true);\n    });\n\n    newSocket.on('disconnect', () => {\n      console.log('Disconnected from notification service');\n      setIsConnected(false);\n    });\n\n    newSocket.on('connect_error', (error) => {\n      console.error('Socket connection error:', error);\n      setIsConnected(false);\n    });\n\n    // Listen for notifications\n    newSocket.on('notification', (notification: Notification) => {\n      setNotifications(prev => [{\n        ...notification,\n        timestamp: new Date(notification.timestamp)\n      }, ...prev].slice(0, 50)); // Keep last 50 notifications\n    });\n\n    // Listen for campaign updates\n    newSocket.on('campaign_update', (update: CampaignUpdate) => {\n      setCampaignUpdates(prev => [{\n        ...update,\n        timestamp: new Date(update.timestamp)\n      }, ...prev].slice(0, 100)); // Keep last 100 campaign updates\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.close();\n    };\n  }, [token]);\n\n  const subscribeToCampaign = (campaignId: string) => {\n    if (socket && isConnected) {\n      socket.emit('subscribe_campaign', campaignId);\n      console.log(`Subscribed to campaign: ${campaignId}`);\n    }\n  };\n\n  const unsubscribeFromCampaign = (campaignId: string) => {\n    if (socket && isConnected) {\n      socket.emit('unsubscribe_campaign', campaignId);\n      console.log(`Unsubscribed from campaign: ${campaignId}`);\n    }\n  };\n\n  const clearNotifications = () => {\n    setNotifications([]);\n  };\n\n  const markAsRead = (index: number) => {\n    setNotifications(prev => {\n      const updated = [...prev];\n      if (updated[index]) {\n        updated[index] = { ...updated[index], read: true } as any;\n      }\n      return updated;\n    });\n  };\n\n  return {\n    socket,\n    isConnected,\n    notifications,\n    campaignUpdates,\n    subscribeToCampaign,\n    unsubscribeFromCampaign,\n    clearNotifications,\n    markAsRead\n  };\n};